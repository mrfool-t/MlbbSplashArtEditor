<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Resme Yazı Ekle</title>

<style>
    body {
        font-family: Arial;
        padding: 15px;
        max-width: 900px;
        margin: auto;
    }

    #editor {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    #previewWrapper {
        position: relative;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
        margin-top: 20px;
    }

    #previewImg {
        width: 100%;
        height: auto;
        display: block;
    }

    #previewText {
        position: absolute;
        transform: translate(-50%, -50%);
        border: 1px dashed #aaa;
        padding: 3px 7px;
        pointer-events: none;
        background: transparent;
        white-space: nowrap;
    }

    button {
        padding: 10px;
        font-size: 16px;
        cursor: pointer;
    }

</style>
</head>

<body>

<h2>Resme Yazı Ekle</h2>

<div id="editor">

    <input type="file" id="imageInput">

    Metin:  
    <input type="text" id="textInput">

    Boyut (px):  
    <input type="number" id="fontSize" value="40">

    Renk:
    <input type="color" id="colorInput" value="#ffffff">

    Yazı Tipi:
    <select id="fontSelect">
        <option>Arial</option>
        <option>Verdana</option>
        <option>Times New Roman</option>
        <option>Impact</option>
        <option>Courier New</option>
    </select>

    Konum X:
    <input type="number" id="posX" value="200">
    Konum Y:
    <input type="number" id="posY" value="200">

    <button id="apply">Yazıyı Ekle (Önizleme)</button>
    <button id="download">İndir</button>

</div>

<div id="previewWrapper">
    <img id="previewImg">
    <div id="previewText"></div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let loadedImg = null;

// Resim yükleme
document.getElementById("imageInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const url = URL.createObjectURL(file);
    loadedImg = new Image();
    loadedImg.onload = () => {
        document.getElementById("previewImg").src = url;
    };
    loadedImg.src = url;
});

// ÖNİZLEME (yazıyı ekle)
document.getElementById("apply").addEventListener("click", function() {
    const txt = document.getElementById("textInput").value;
    const fs  = document.getElementById("fontSize").value;
    const col = document.getElementById("colorInput").value;
    const font = document.getElementById("fontSelect").value;
    const x = document.getElementById("posX").value;
    const y = document.getElementById("posY").value;

    const preview = document.getElementById("previewText");

    preview.style.fontSize = fs + "px";
    preview.style.color = col;
    preview.style.fontFamily = font;
    preview.style.left = x + "px";
    preview.style.top = y + "px";
    preview.textContent = txt;
});


// İNDİR (kayma sorunu giderildi)
document.getElementById("download").addEventListener("click", function() {
    if (!loadedImg) return;

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // Gerçek çözünürlükte çiz
    canvas.width = loadedImg.width;
    canvas.height = loadedImg.height;

    ctx.drawImage(loadedImg, 0, 0);

    // Değerleri al
    const txt = document.getElementById("textInput").value;
    const fs  = document.getElementById("fontSize").value;
    const col = document.getElementById("colorInput").value;
    const font = document.getElementById("fontSelect").value;
    const x = parseInt(document.getElementById("posX").value);
    const y = parseInt(document.getElementById("posY").value);

    // RESPONSIVE BOYUT DÖNÜŞÜMÜ (EN ÖNEMLİ KISIM)
    const previewImg = document.getElementById("previewImg");
    const scaleX = loadedImg.width / previewImg.clientWidth;
    const scaleY = loadedImg.height / previewImg.clientHeight;

    const realX = x * scaleX;
    const realY = y * scaleY;

    ctx.font = fs * scaleX + "px " + font;
    ctx.fillStyle = col;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    ctx.fillText(txt, realX, realY);

    // İndirme
    const a = document.createElement("a");
    a.download = "duzenlenmis.png";
    a.href = canvas.toDataURL();
    a.click();
});
</script>
<a href="https://drive.google.com/drive/u/0/mobile/folders/12kcSDAUlhe6c1dL8Z4Itt4HmbshWAHGH">SPLASHART İNDİRME</a>
</body>
</html>